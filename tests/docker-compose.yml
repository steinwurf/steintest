version: "3"
services:
  mongodb:
    image: mongo:4.0.4
    ports:
      - "27017:27017"
    networks:
      - my_network

  server:
    build: ../cmd/server
    ports:
      - "8080:8080"
    networks:
      - my_network


  client:
    networks:
      - my_network
    depends_on:
      - server
    build: ../cmd/client
    command: ["sh", "-c", "sleep 5 && tc qdisc add dev eth0 root netem loss ${LOSS_RATE}% && ./client -Ip server -Duration ${DURATION} -PacketSize ${PACKETSIZE} -Frequency ${FREQUENCY}"]
    privileged: true
networks:
  my_network:
